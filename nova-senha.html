<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Redefinir SenhA - SustentArte</title>
<style>
  :root{
    --mascote-h: 150px;
    --gap-top: 16px;
  }

  *{box-sizing:border-box;margin:0;padding:0}

  body{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    padding:20px;
    font-family:"Poppins",sans-serif;
    background:#b8f5b0;
    border:10px solid #2e7d32;
    border-radius:15px;
    box-shadow:inset 0 0 15px rgba(0,100,0,0.35);
    overflow:auto;
    position:relative;
  }

  .recycle-icon{position:absolute;width:80px;opacity:.07;pointer-events:none}
  .recycle1{top:8%;left:8%}
  .recycle2{bottom:10%;right:8%}
  .recycle3{top:50%;right:28%}

  .login-container{width:100%;max-width:440px;padding:12px;position:relative;z-index:1;flex:1;display:flex;align-items:center;justify-content:center;}

  .login-box{
    position:relative;
    background:#dff5cf;
    border:6px solid #2e7d32;
    border-radius:20px;
    box-shadow:0 8px 30px rgba(0,0,0,.18);
    padding:calc(var(--mascote-h)/2 + var(--gap-top)) 28px 28px;
    text-align:center;
    color:#1b5e20;
  }

  .login-box .mascote{
    position:absolute;
    top:-36px;
    left:50%;
    transform:translate(-50%,-50%);
    width:var(--mascote-h);
    height:auto;
    z-index:2;
    pointer-events:none;
  }

  .login-box h2{font-size:1.6rem;margin-bottom:18px}

  .input-group{text-align:left;margin-bottom:16px}
  .input-group label{display:block;font-weight:700;color:#1b5e20;margin-bottom:6px;font-size:.95rem}
  .input-group input{
    width:100%;
    padding:12px;
    border-radius:10px;
    border:2px solid #81c784;
    background:#fff;
    color:#2e7d32;
    font-size:1rem;
  }
  .input-group input:focus{outline:none;box-shadow:0 0 6px rgba(67,160,71,.28);border-color:#43a047}

  .senha-wrapper{position:relative}
  .icone-olho{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:26px;cursor:pointer}

  button[type="submit"]{
    width:100%;
    padding:14px;
    border-radius:10px;
    border:none;
    background:#43a047;
    color:#fff;
    font-weight:700;
    font-size:1rem;
    cursor:pointer;
  }
  button[type="submit"]:hover{background:#2e7d32}

  footer{
    width:100%;
    display:flex;
    align-items:center;
    justify-content:flex-start;
    padding:10px 20px;
    position:absolute;
    bottom:0;
    left:0;
  }
  footer img{height:40px;width:auto;}

  .mensagem {
    display:none;
    margin-top:14px;
    padding:10px;
    border-radius:10px;
    font-weight:600;
    font-size:.9rem;
    animation:fadeIn .3s ease;
  }
  @keyframes fadeIn {
    from{opacity:0;transform:scale(0.95);}
    to{opacity:1;transform:scale(1);}
  }
  .erro{background:#ffb3b3;color:#7a0000;border:2px solid #d32f2f;}
  .sucesso{background:#c8f7c5;color:#1b5e20;border:2px solid #388e3c;}

  @media (max-width:900px){
    :root{--mascote-h:140px}
    .login-box{padding-left:22px;padding-right:22px}
  }
  @media (max-width:600px){
    :root{--mascote-h:120px}
    .login-box{padding-left:18px;padding-right:18px}
    .login-box h2{font-size:1.35rem}
    .icone-olho{width:22px}
  }
  @media (max-width:400px){
    :root{--mascote-h:100px;--gap-top:12px}
    .login-box{padding-left:14px;padding-right:14px}
    .login-box h2{font-size:1.15rem}
  }
</style>
</head>
<body>

  <img src="recycle.png" class="recycle-icon recycle1" alt="">
  <img src="recycle.png" class="recycle-icon recycle2" alt="">
  <img src="recycle.png" class="recycle-icon recycle3" alt="">

  <div class="login-container">
    <div class="login-box">
      <img id="mascote" class="mascote" src="mascoteBlind.png" alt="Mascote">
      <h2>Redefinir Senha</h2>

      <form id="reset-form">
        <div class="input-group">
          <label for="senha">Nova Senha</label>
          <div class="senha-wrapper">
            <input id="senha" type="password" placeholder="Digite sua nova senha" required>
            <img id="toggleSenha" class="icone-olho" src="olhoFechado.png" alt="Mostrar senha">
          </div>
        </div>

        <div class="input-group">
          <label for="confirmar">Confirmar Senha</label>
          <div class="senha-wrapper">
            <input id="confirmar" type="password" placeholder="Confirme sua senha" required>
            <img id="toggleConfirmar" class="icone-olho" src="olhoFechado.png" alt="Mostrar senha">
          </div>
        </div>

        <button type="submit">Salvar nova senha</button>
        <div id="mensagem" class="mensagem"></div>
      </form>
    </div>
  </div>

  <footer>
    <img src="logo-crescimento.png" alt="Logo Crescimento">
  </footer>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

  const supabaseUrl = 'https://afobiejrsjolurxeqnuz.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFmb2JpZWpyc2pvbHVyeGVxbnV6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NTkxMDAsImV4cCI6MjA3ODEzNTEwMH0.dhHgjXnOzZE5f3HDBzgBjuZss33LrGPuM1ckKeG6-bw';
  const supabase = createClient(supabaseUrl, supabaseKey);

  const senhaInput = document.getElementById('senha');
  const confirmarInput = document.getElementById('confirmar');
  const toggleSenha = document.getElementById('toggleSenha');
  const toggleConfirmar = document.getElementById('toggleConfirmar');
  const mascote = document.getElementById('mascote');
  const mensagem = document.getElementById('mensagem');

  function alternarVisibilidade(input, icone) {
    const isPassword = input.type === 'password';
    input.type = isPassword ? 'text' : 'password';
    icone.src = isPassword ? 'olhoAberto.png' : 'olhoFechado.png';
    mascote.src = isPassword ? 'mascote.png' : 'mascoteBlind.png';
  }

  toggleSenha.addEventListener('click', () => {
    alternarVisibilidade(senhaInput, toggleSenha);
    alternarVisibilidade(confirmarInput, toggleConfirmar);
  });

  toggleConfirmar.addEventListener('click', () => {
    alternarVisibilidade(senhaInput, toggleSenha);
    alternarVisibilidade(confirmarInput, toggleConfirmar);
  });

  document.getElementById('reset-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const senha = senhaInput.value.trim();
    const confirmar = confirmarInput.value.trim();
    mensagem.style.display = 'none';

    if (senha !== confirmar) {
      mostrarMensagem('As senhas não coincidem.', 'erro');
      return;
    }

    try {
      const { error } = await supabase.auth.updateUser({ password: senha }, {
  redirectTo: "https://sr-junkie.github.io/SustentArte/#/nova-senha.html"
});
      if (error) throw error;
      mostrarMensagem('Senha redefinida com sucesso! Agora faça login.', 'sucesso');
      setTimeout(() => window.location.href = 'login.html', 2500);
    } catch (err) {
      mostrarMensagem('Erro ao redefinir senha: ' + err.message, 'erro');
    }
  });

  function mostrarMensagem(texto, tipo) {
    mensagem.textContent = texto;
    mensagem.className = 'mensagem ' + tipo;
    mensagem.style.display = 'block';
  }
</script>
</body>
</html>
